<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DO-AN-02: 1 - XIN CHÀO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DO-AN-02<span id="projectnumber">&#160;0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2welcom-to-my-team-vie.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">1 - XIN CHÀO</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md10"></a> Cảm ơn bạn đã tham gia vào nhóm của mình. Dưới đây là phần giới thiệu về các quy ước trong viết mã.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
2 - CÁC QUY ƯỚC</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
2.1 - Chú thích (Comment)</h2>
<p>Việc chú thích sẽ làm mất thời gian trong lúc viết mã (coding) của bạn hơn, nhưng đổi lại bạn sẽ dễ hiểu mã của bạn hơn sau này, hoặc một lúc sau đó. Ngoài ra còn giúp các bạn chung nhóm khác hiểu khái quát về đoạn mã.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
2.1.1 - Chú thích biến, struct, enum, union, macro</h3>
<p>Mình thường sử dụng chú thích kiểu Doxygen cho các hàm, và kiểu chú thích thông thường cho các biến.</p>
<p><b>NOTE:</b></p>
<ul>
<li>Đối với chú thích bình thường <code>//</code> hay <code>///</code> là như nhau!</li>
<li>Hãy viết hàm trước, sau đó chú thích sau nếu hàm <b>không quá phức tạp</b>.</li>
<li>Hãy chú thích trường hợp trước, và viết code sau nếu <b>hàm phức tạp</b>.</li>
</ul>
<p><b>Ví dụ 2.1.1.1: Chú thích kiểu Doxygen cho biến, các thuộc tính của struct, enum, ...</b></p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span>* buffPtr;</div>
<div class="line">    <span class="keywordtype">int</span> buffSize;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span>* buffPtr;               </div>
<div class="line">    <span class="keywordtype">int</span> buffSize;               </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">        path_t      configPath;</div>
<div class="line">        int32_t     configNum;</div>
<div class="line">        uint8_t*    configType;</div>
<div class="line">        label_t*    configLabel;</div>
<div class="line">        txtVal_t*   configValue;</div>
<div class="line">    } config_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">        path_t      configPath;                     </div>
<div class="line">        int32_t     configNum;                      </div>
<div class="line">        uint8_t*    configType;                     </div>
<div class="line">        label_t*    configLabel;                    </div>
<div class="line">        txtVal_t*   configValue;                    </div>
<div class="line">    } config_t;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> CONFIG_STATUS_RETURN_TYPE {</div>
<div class="line">        CONFIG_STATUS_OKE = 0,              </div>
<div class="line">        CONFIG_STATUS_NULL_ERROR,           </div>
<div class="line">        CONFIG_STATUS_ALLOC_FAILED,         </div>
<div class="line">        CONFIG_STATUS_UNKNOWN_ERROR,        </div>
<div class="line">        CONFIG_STATUS_FILE_NOT_FOUND,       </div>
<div class="line">        CONFIG_STATUS_PARAMETER_ERROR,      </div>
<div class="line">        CONFIG_STATUS_FILE_NOT_EXISTED,     </div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> CONFIG_STATUS_RETURN_TYPE {</div>
<div class="line">        CONFIG_STATUS_OKE = 0,</div>
<div class="line">        </div>
<div class="line">        CONFIG_STATUS_NULL_ERROR,</div>
<div class="line">        CONFIG_STATUS_ALLOC_FAILED,</div>
<div class="line">        CONFIG_STATUS_UNKNOWN_ERROR,</div>
<div class="line">        CONFIG_STATUS_FILE_NOT_FOUND,</div>
<div class="line">        CONFIG_STATUS_PARAMETER_ERROR,</div>
<div class="line">        CONFIG_STATUS_FILE_NOT_EXISTED,</div>
<div class="line">    };</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #define CONFIG_PREFIX        &quot;__NGXXFUS__BEGIN_OF_CONFIG__&quot;</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_SIZE_PREFIX   &quot;__NGXXFUS__NUMBER_OF_CONFIG_&quot;</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_SUFFIX        &quot;__NGXXFUS__END_OF_CONFIG____&quot;</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md14"></a>
2.1.2 - Chú thích hàm, thủ tục, macro</h3>
<p><b>Ví dụ 2.1.2.1: Chú thích kiểu Doxygen cho hàm</b></p>
<p><b>NOTE:</b></p><ul>
<li>Ngoài dùng <code>///</code> cho từng dòng trong chú thích kiểu Doxygen, còn có thể gom hết vào một <code>/**/</code> (chú thích đoạn, xem phần chú thích cho macro)</li>
<li>Có thể sử dụng chú thích <code>//comment</code> hay <code>/*comment*/</code> cho hàm.</li>
</ul>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> aFunction(<span class="keywordtype">int</span> aParam0, <span class="keywordtype">int</span>* aParam1){</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> coefficient = 19;</div>
<div class="line">        coefficient = ((coefficient*aParam0/17)&lt;&lt;2) +  ((coefficient*aParam0/37)&gt;&gt;2);</div>
<div class="line">        *aParam1 = coefficient;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> aFunction(<span class="keywordtype">int</span> aParam){</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> coefficient = 19;</div>
<div class="line">        coefficient = ((coefficient*aParam/17)&lt;&lt;2) +  ((coefficient*aParam/37)&gt;&gt;2);</div>
<div class="line">        <span class="keywordflow">return</span> coefficient;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">    #ifndef REVT</span></div>
<div class="line"><span class="preprocessor">        #define REVT(type, i, a, b) for(type i = (a); (i) &gt; (b); --(i))</span></div>
<div class="line"><span class="preprocessor">    #endif</span></div>
</div><!-- fragment --><p>Ngoài ra cũng có thể dùng chú thích thường để chú thích cho hàm</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> build_data_filename(<span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> buflen, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *datatype, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> unlink_if_exists(<span class="keyword">const</span> <span class="keywordtype">char</span> *path);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
2.2 - Đặt tên hàm và biến</h2>
<p>Để tiện lợi trong quá trình phát triển và bảo trì mã nguồn, chúng ta phải thống nhất một số quy ước về cách đặt tên biến. Trong các ngôn ngữ như C/C++/Python, các ký tự hoa và thường là phân biệt nhau!</p>
<h3><a class="anchor" id="autotoc_md16"></a>
2.2.1 - Quy tắc đặt tên chung</h3>
<ul>
<li>Viết thường đối với tên biến có một từ. VD: <code>text</code>, <code>buff</code></li>
<li>Đối với các biến dạng private (C++/class), cục bộ/nội bộ (local) thì nên thêm <code>__</code> vào làm tiền tố.</li>
<li>Từ (word) đầu tiên viết thường, các từ còn lại viết hoa chữ cái đầu. VD: <code>textSize</code>, <code>buffSize</code></li>
<li>Viết hoa ký tự viết tắt</li>
<li>Đối với số thì thường đặt cuối</li>
<li>IN HOA toàn bộ đối với macro hằng, enum</li>
</ul>
<p><b>Ví dụ 2.2.1.1: Ví dụ đặt tên biến và hàm theo quy tắc chung</b></p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">    pthread_mutex_t logMutex = PTHREAD_MUTEX_INITIALIZER;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> __entryCriticalSection(pthread_mutex_t* mutex) {</div>
<div class="line">        <span class="keywordtype">int</span> rc = pthread_mutex_lock(mutex);</div>
<div class="line">        <span class="keywordflow">if</span> (rc) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;[err] [critical section] Lock failed: %d\n&quot;</span>, rc);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_define" href="espRTOSWrapper_8h.html#a7928c73b85087899228d01b38902c429">__exitCriticalSection</a>(pthread_mutex_t* mutex) {</div>
<div class="line">        <span class="keywordtype">int</span> rc = pthread_mutex_unlock(mutex);</div>
<div class="line">        <span class="keywordflow">if</span> (rc) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;[err] [critical section] Unlock failed: %d\n&quot;</span>, rc);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #define fMask(f)            __mask64(f)</span></div>
<div class="line"><span class="preprocessor">    #define fInvMask(f)         __inv_mask64(f)</span></div>
<div class="line"><span class="preprocessor">    #define hasFlag(f)          &amp; fMask(f)</span></div>
<div class="line"><span class="preprocessor">    #define setFlag(f)          |= fMask(f)</span></div>
<div class="line"><span class="preprocessor">    #define clrFlag(f)          &amp;= fInvMask(f)</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">extern</span> windowContext_t *    oscWin;</div>
<div class="line">    <span class="keyword">extern</span> pthread_mutex_t      sdlMutex;                   </div>
<div class="line">    <span class="keyword">extern</span> pthread_mutex_t      scrBufMutex;                </div>
<div class="line">    <span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_typedef" href="oled128x64Definitions_8h.html#a4a866609d9773434a60de3bfe7b66596">xy_t</a>           screenW;                    </div>
<div class="line">    <span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_typedef" href="oled128x64Definitions_8h.html#a4a866609d9773434a60de3bfe7b66596">xy_t</a>           screenH;                    </div>
<div class="line">    <span class="keyword">extern</span> <a class="code hl_typedef" href="lcd32Def_8h.html#a0a8ef1b5e1941b7257e545cc33405ff1">color_t</a> *            screenBuffer;               </div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #define CONFIG_PATH_SIZE     256</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_LABEL_SIZE     64</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_VALUE_SIZE    256</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">    #define CONFIG_PREFIX        &quot;__NGXXFUS__BEGIN_OF_CONFIG__&quot;</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_SIZE_PREFIX   &quot;__NGXXFUS__NUMBER_OF_CONFIG_&quot;</span></div>
<div class="line"><span class="preprocessor">    #define CONFIG_SUFFIX        &quot;__NGXXFUS__END_OF_CONFIG____&quot;</span></div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #define STRINGIFY(x) #x</span></div>
<div class="line"><span class="preprocessor">    #define NAME2STR(x) STRINGIFY(x)</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> CONFIG_STATUS_RETURN_TYPE {</div>
<div class="line">        CONFIG_STATUS_OKE = 0,              </div>
<div class="line">        CONFIG_STATUS_NULL_ERROR,           </div>
<div class="line">        CONFIG_STATUS_ALLOC_FAILED,         </div>
<div class="line">        CONFIG_STATUS_UNKNOWN_ERROR,        </div>
<div class="line">        CONFIG_STATUS_FILE_NOT_FOUND,       </div>
<div class="line">        CONFIG_STATUS_PARAMETER_ERROR,      </div>
<div class="line">        CONFIG_STATUS_FILE_NOT_EXISTED,     </div>
<div class="line">    };</div>
<div class="ttc" id="aespRTOSWrapper_8h_html_a7928c73b85087899228d01b38902c429"><div class="ttname"><a href="espRTOSWrapper_8h.html#a7928c73b85087899228d01b38902c429">__exitCriticalSection</a></div><div class="ttdeci">#define __exitCriticalSection(mutex_ptr)</div><div class="ttdoc">Exit critical section with given mutex (restore interrupts after region)</div><div class="ttdef"><b>Definition</b> espRTOSWrapper.h:19</div></div>
<div class="ttc" id="alcd32Def_8h_html_a0a8ef1b5e1941b7257e545cc33405ff1"><div class="ttname"><a href="lcd32Def_8h.html#a0a8ef1b5e1941b7257e545cc33405ff1">color_t</a></div><div class="ttdeci">uint16_t color_t</div><div class="ttdoc">Alias for pixel color type (e.g., 0 = black, 1 = white)</div><div class="ttdef"><b>Definition</b> lcd32Def.h:9</div></div>
<div class="ttc" id="aoled128x64Definitions_8h_html_a4a866609d9773434a60de3bfe7b66596"><div class="ttname"><a href="oled128x64Definitions_8h.html#a4a866609d9773434a60de3bfe7b66596">xy_t</a></div><div class="ttdeci">int16_t xy_t</div><div class="ttdoc">Alias for signed 16-bit coordinate type.</div><div class="ttdef"><b>Definition</b> oled128x64Definitions.h:46</div></div>
</div><!-- fragment --><p>Lưu ý: Không viết tắt quá nhiều, sẽ khó đọc.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
2.2.2 - Quy tắc đặt tên bất thường</h3>
<ul>
<li>Thêm tiền tố vào để đánh dấu các hàm, biến này cùng thuộc một nhóm.</li>
<li>Có thể thêm tiền tố <code>&lt;GROUP&gt;__</code> dạng <code>&lt;GROUP&gt;__TextTextNumber</code> để đánh dấu tên hàm và biến thuộc một nhóm, VD: <code>SDL_Rect</code>, <code>SDL_Texture</code>.</li>
<li>Thêm hậu tố <code>_t</code> để đánh dấu là kiểu dữ liệu được định nghĩa.</li>
</ul>
<p><b>Ví dụ 2.2.2.1: Ví dụ đặt tên biến và hàm theo quy tắc bất thường</b></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> int8_t      confStatus_t;</div>
<div class="line"><span class="keyword">typedef</span> int32_t     numVal_t;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *      txtVal_t;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *      label_t;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">char</span> *      path_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> CONFIG_TYPE {</div>
<div class="line">    CONFIG_TYPE_NOT_SET = 0,</div>
<div class="line">    CONFIG_TYPE_TEXT,</div>
<div class="line">    CONFIG_TYPE_NUMBER,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">    path_t      configPath;                     </div>
<div class="line">    int32_t     configNum;                      </div>
<div class="line">    uint8_t*    configType;                     </div>
<div class="line">    label_t*    configLabel;                    </div>
<div class="line">    txtVal_t*   configValue;                    </div>
<div class="line">} config_t;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
2.3 - Trường tượng hóa/Chuẩn hóa kiểu dữ liệu</h2>
<p>Trừu tượng hóa cho phép chúng ta tập trung vào những khái niệm chung, thay vì bị chi phối bởi quá nhiều chi tiết nhỏ. Chuẩn hóa giúp mã nguồn dễ đọc, dễ bảo trì hơn và làm cho luồng tư duy trong quá trình phát triển phần mềm trở nên rõ ràng, mạch lạc hơn.</p>
<ul>
<li>Trừu tượng hóa: đặt tên kiểu dữ liệu sao cho phù hợp với ý nghĩa và mục đích sử dụng, thay vì dùng trực tiếp kiểu dữ liệu nguyên thủy.</li>
<li>Chuẩn hóa: đảm bảo sự thống nhất trong cách sử dụng dữ liệu. Khi có sự thay đổi về định nghĩa kiểu dữ liệu, hệ thống sẽ ít bị ảnh hưởng (hoặc không bị ảnh hưởng) nhờ việc dùng các kiểu đã được chuẩn hóa thay thế cho kiểu gốc.</li>
<li>Kể cả việc trả về trạng thái lỗi, khi ta chuẩn hóa thông qua các ENUM, ta sẽ dễ để gỡ lỗi (debug) hơn.</li>
</ul>
<p><b>Ví dụ 2.3.1: Ví dụ về trường tượng hóa/chuẩn hóa kiểu dữ liệu</b></p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">        <span class="keywordtype">char</span>*       configPath;                     </div>
<div class="line">        int32_t     configNum;                      </div>
<div class="line">        uint8_t*    configType;                     </div>
<div class="line">        <span class="keywordtype">char</span>**      configLabel;                    </div>
<div class="line">        <span class="keywordtype">char</span>**      configValue;                    </div>
<div class="line">    } config_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> intToStr(<span class="keywordtype">char</span>* result, <span class="keywordtype">size_t</span> resultSize, int32_t value);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> intToStr(<span class="keywordtype">char</span>* result, <span class="keywordtype">size_t</span> resultSize, int32_t value);</div>
<div class="line"> </div>
<div class="line">    int8_t initialConfigFromGZFile(config_t ** confPtr, <span class="keyword">const</span> <span class="keywordtype">char</span>* gzPath);</div>
<div class="line"> </div>
<div class="line">    int8_t createConfig(config_t ** confPtr, <span class="keyword">const</span> <span class="keywordtype">char</span>* path, int32_t confNum);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> deleteConfig(config_t ** confPtr);</div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> int8_t      confStatus_t;</div>
<div class="line">    <span class="keyword">typedef</span> int32_t     numVal_t;</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keywordtype">char</span> *      txtVal_t;</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keywordtype">char</span> *      label_t;</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keywordtype">char</span> *      path_t;</div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">        path_t      configPath;                     </div>
<div class="line">        int32_t     configNum;                      </div>
<div class="line">        uint8_t*    configType;                     </div>
<div class="line">        label_t*    configLabel;                    </div>
<div class="line">        txtVal_t*   configValue;                    </div>
<div class="line">    } config_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> intToStr(<span class="keywordtype">char</span>* result, <span class="keywordtype">size_t</span> resultSize, int32_t value);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> intToStr(<span class="keywordtype">char</span>* result, <span class="keywordtype">size_t</span> resultSize, int32_t value);</div>
<div class="line"> </div>
<div class="line">    confStatus_t initialConfigFromGZFile(config_t ** confPtr, <span class="keyword">const</span> path_t gzPath);</div>
<div class="line"> </div>
<div class="line">    confStatus_t createConfig(config_t ** confPtr, <span class="keyword">const</span> path_t path, int32_t confNum);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> deleteConfig(config_t ** confPtr);</div>
<div class="line"> </div>
<div class="line">    ...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
2.4 - Tổ chức mã nguồn</h2>
<p>Thông thường, mình sẽ chia các tính năng thành các module và sau đó kết hợp lại. Sơ đồ bên dưới là một ví dụ về cách tổ chức mã nguồn.</p>
<div class="fragment"><div class="line">.</div>
<div class="line">├── Makefile</div>
<div class="line">├── clipboard</div>
<div class="line">│   ├── clipboard.c</div>
<div class="line">│   ├── clipboard.h</div>
<div class="line">│   └── clipboard.o</div>
<div class="line">├── config</div>
<div class="line">│   ├── config.c</div>
<div class="line">│   ├── config.h</div>
<div class="line">│   └── config.o</div>
<div class="line">├── helper</div>
<div class="line">│   └── helper.h</div>
<div class="line">├── log</div>
<div class="line">│   ├── log.c</div>
<div class="line">│   ├── log.h</div>
<div class="line">│   └── log.o</div>
<div class="line">├── clipboardService</div>
<div class="line">├── clipboardService.c</div>
<div class="line">├── clipboardService.h</div>
<div class="line">├── clipboardService.o</div>
<div class="line">├── note.md</div>
<div class="line">└── test_config.gz</div>
</div><!-- fragment --><p>Đối vơi các thiết lập toàn cục (global config), các tiện tích (helpers/utils), nên được tổ chức riêng thành các module và sẽ được nhập (include) lại ở mỗi mô đun con.</p>
<p>Sơ đồ bên dưới mô thả một quá trình biên dịch các file.c từ log.c, config.c, clipboard.c và clipboardService.c.</p>
<div class="fragment"><div class="line">^ Thứ tự truy vết các header (file.h)</div>
<div class="line">global.h</div>
<div class="line">^</div>
<div class="line">├────────────────── log.h</div>
<div class="line">                    ^</div>
<div class="line">                    ├────────────────── log.c</div>
<div class="line">global.h</div>
<div class="line">^</div>
<div class="line">├────────────────── log.h</div>
<div class="line">                    ^</div>
<div class="line">                    ├────────────────── config.h</div>
<div class="line">                                        ^</div>
<div class="line">                                        ├────────────────────── config.c</div>
<div class="line">global.h</div>
<div class="line">^</div>
<div class="line">├────────────────── log.h</div>
<div class="line">                    ^</div>
<div class="line">                    ├────────────────── clipboard.h</div>
<div class="line">                                        ^</div>
<div class="line">                                        ├────────────────────── clipboard.c</div>
<div class="line">global.h</div>
<div class="line">^</div>
<div class="line">├────────────────── log.h</div>
<div class="line">                    ^</div>
<div class="line">                    ├────────────────── config.h</div>
<div class="line">                                        ^</div>
<div class="line">                                        ├────────────────────── clipboardService.h</div>
<div class="line">                                                                ^</div>
<div class="line">                                                                ├───────── clipboardService.c</div>
</div><!-- fragment --><p>Sơ đồ bên dưới mô thả mối quan hệ giữa các module.</p>
<div class="fragment"><div class="line">───&gt; Thứ tự nhập các mô đun</div>
<div class="line"> </div>
<div class="line">global.h            log.h(+log.c)           helper.h</div>
<div class="line">│                   │</div>
<div class="line">├──────────────────&gt;├──────────────────────&gt;├─────────────────────────────────&gt; clipboard.h(+clipboard.c)</div>
<div class="line">                                            │                                   │</div>
<div class="line">                                            │                                   │</div>
<div class="line">                                            ├───── config.h(+config.c)          │</div>
<div class="line">                                                    │                           │</div>
<div class="line">                                                    ├──────────────────────────&gt;├─────────&gt; clipboardService.h</div>
<div class="line">                                                                                            │</div>
<div class="line">                                                                                            ├─────────&gt; clipboardService.c</div>
</div><!-- fragment --><p><b>NOTE</b>:</p><ul>
<li>Do có các định danh macro (VD: <code>__CONFIG_H__</code>) kết hợp với các chỉ thị (directive) (VD: <code>#ifdef</code> <code>#ifndef</code> <code>#endif</code>) nên các header file (file.h) sẽ không bị trùng lặp. Các file.c sẽ được biên dịch nhau và liên kết lại bởi linker.</li>
<li>Các biến toàn cục trong các file này nên dùng <code>extern</code> và khai báo chính thức ở file.c nào đó (tốt nhất là trong file.c của mô đun).</li>
</ul>
<h3><a class="anchor" id="autotoc_md20"></a>
2.4.1 - Quy ước chung</h3>
<ul>
<li>Bắt buộc dùng <code>include guard</code> cho các file.h.</li>
<li>Khai báo ở header (file.h) với extern; Định nghĩa duy nhất ở file.c của mô đun chứa biến đó.</li>
<li>Nguyên tắc DAG (Directed Acyclic Graph): không để hai mô đun phụ thuộc vòng tròn (A → B → A).</li>
<li>Nguyên tắc layering: mô đun thấp (<a class="el" href="helper_8h.html" title="Common helper macros for loops, bit manipulation, math, and pointer handling.">helper.h</a>) không được include ngược lại mô đun cao hơn (clipboardService.h).</li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
2.5 – Quy tắc viết mã (Code Style)</h2>
<p>Quy tắc trình bày mã sẽ làm cho cấu trúc mã thống nhất hơn.</p>
<ul>
<li>Mỗi hàm một chức năng, không nên gom quá nhiều chức năng vào một hàm.</li>
<li>Quy ước 01 tab = 04 space</li>
<li>Mở khối lệnh lại dòng khai báo, dòng điều kiện, ...</li>
</ul>
<div class="fragment"><div class="line"> </div>
<div class="line">    </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t {</div>
<div class="line">        path_t      configPath;                     </div>
<div class="line">        int32_t     configNum;                      </div>
<div class="line">        uint8_t*    configType;                     </div>
<div class="line">        label_t*    configLabel;                    </div>
<div class="line">        txtVal_t*   configValue;                    </div>
<div class="line">    } config_t;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> aFunction0(<span class="keywordtype">int</span> aParam0, <span class="keywordtype">int</span>* aParam1){</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> coefficient = 19;</div>
<div class="line">        <span class="keywordflow">if</span>(aParam0 &gt; 0){</div>
<div class="line">            aParam0 = aParam0 * 99741 / 53246;</div>
<div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(aParam0 &lt; 0){</div>
<div class="line">            aParam0 = -1 * aParam0;</div>
<div class="line">        }<span class="keywordflow">else</span>{</div>
<div class="line">            aParam0 = coefficient * 92641 / 56746;</div>
<div class="line">        }</div>
<div class="line">        coefficient = ((coefficient*aParam0/17)&lt;&lt;2) +  ((coefficient*aParam0/37)&gt;&gt;2);</div>
<div class="line">        *aParam1 = coefficient;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> aFunction1(<span class="keywordtype">int</span> aParam0, <span class="keywordtype">int</span>* aParam1){</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> coefficient = 19;</div>
<div class="line">        <span class="keywordflow">if</span>(aParam0 &gt; 0){</div>
<div class="line">            aParam0 = aParam0 * 99741 / 53246;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span>(aParam0 &lt; 0){</div>
<div class="line">                aParam0 = -1 * aParam0;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                aParam0 = coefficient * 92641 / 56746;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        coefficient = ((coefficient*aParam0/17)&lt;&lt;2) +  ((coefficient*aParam0/37)&gt;&gt;2);</div>
<div class="line">        *aParam1 = coefficient;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">struct </span>config_t </div>
<div class="line">    {</div>
<div class="line">        path_t      configPath;                     </div>
<div class="line">        int32_t     configNum;                      </div>
<div class="line">        uint8_t*    configType;                     </div>
<div class="line">        label_t*    configLabel;                    </div>
<div class="line">        txtVal_t*   configValue;                    </div>
<div class="line">    } </div>
<div class="line">    config_t;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> aFunction(<span class="keywordtype">int</span> aParam0, <span class="keywordtype">int</span>* aParam1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> coefficient = 19;</div>
<div class="line">        <span class="keywordflow">if</span>(aParam0 &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            aParam0 = aParam0 * 99741 / 53246;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> </div>
<div class="line">        <span class="keywordflow">if</span>(aParam0 &lt; 0){</div>
<div class="line">            aParam0 = -1 * aParam0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            aParam0 = coefficient * 92641 / 56746;</div>
<div class="line">        }</div>
<div class="line">        coefficient = ((coefficient*aParam0/17)&lt;&lt;2) +  ((coefficient*aParam0/37)&gt;&gt;2);</div>
<div class="line">        *aParam1 = coefficient;</div>
<div class="line">    }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
3 - Một số tiện tích</h1>
<p>Các tiện ích này sẽ làm cho code trở nên dễ đọc hơn, ngắn gọn hơn. Ví dụ bên dưới là helper dùng trong SDL2.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef __HELPER_H__</span></div>
<div class="line"><span class="preprocessor">#define __HELPER_H__</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef LOG_HEADER_INCLUDE</span></div>
<div class="line"><span class="preprocessor">#pragma message(&quot;INCLUDE: global.h&quot;)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;SDL2/SDL.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SDL2/SDL_ttf.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define REPT(type, i, a, b) for(type i = (a); (i) &lt; (b); ++(i))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define REVT(type, i, a, b) for(type i = (a); (i) &gt; (b); --(i))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define REP(i, a, b) for(simSize_t i = (a); (i) &lt; (b); ++(i))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define REV(i, a, b) for(simSize_t i = (a); (i) &gt; (b); --(i))</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __USEC(i) ((i) * 1000ULL)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __MSEC(i) ((i) * 1000000ULL)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __SEC(i)  ((i) * 1000000000ULL)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __sleep_ms(ms) do { \</span></div>
<div class="line"><span class="preprocessor">    if ((ms) &lt; 0) break; \</span></div>
<div class="line"><span class="preprocessor">    struct timespec ts; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_sec  = (ms) / 1000; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_nsec = ((ms) % 1000) * 1000000L; \</span></div>
<div class="line"><span class="preprocessor">    while (nanosleep(&amp;ts, &amp;ts) == -1 &amp;&amp; errno == EINTR); \</span></div>
<div class="line"><span class="preprocessor">} while(0)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __sleep_ns(ns) do { \</span></div>
<div class="line"><span class="preprocessor">    struct timespec ts; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_sec  = (time_t)((ns) / 1000000000UL); \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_nsec = (long)((ns) % 1000000000UL); \</span></div>
<div class="line"><span class="preprocessor">    nanosleep(&amp;ts, NULL); \</span></div>
<div class="line"><span class="preprocessor">} while(0)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __sleep_us(us) do { \</span></div>
<div class="line"><span class="preprocessor">    struct timespec ts; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_sec  = (us) / 1000000; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_nsec = ((us) % 1000000) * 1000L; \</span></div>
<div class="line"><span class="preprocessor">    nanosleep(&amp;ts, NULL); \</span></div>
<div class="line"><span class="preprocessor">} while(0)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __sleep(sec) do { \</span></div>
<div class="line"><span class="preprocessor">    struct timespec ts; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_sec  = sec; \</span></div>
<div class="line"><span class="preprocessor">    ts.tv_nsec = 0; \</span></div>
<div class="line"><span class="preprocessor">    nanosleep(&amp;ts, NULL); \</span></div>
<div class="line"><span class="preprocessor">} while(0)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __combiRGB(R, G, B) ((((simColor_t)R)&lt;&lt;24) | (((simColor_t)G)&lt;&lt;16) | (((simColor_t)B)&lt;&lt;8) | ((simColor_t)0xFF))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __combiRGBA(R, G, B, A) ((((simColor_t)R)&lt;&lt;24) | (((simColor_t)G)&lt;&lt;16) | (((simColor_t)B)&lt;&lt;8) | ((simColor_t)A))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __getRFromRGBA(RGBA) (((simColor_t)(RGBA) &gt;&gt; 24) &amp; 0xFF)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __getGFromRGBA(RGBA) (((simColor_t)(RGBA) &gt;&gt; 16) &amp; 0xFF)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __getBFromRGBA(RGBA) (((simColor_t)(RGBA) &gt;&gt;  8) &amp; 0xFF)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __getAFromRGBA(RGBA) (((simColor_t)(RGBA) &gt;&gt;  0) &amp; 0xFF)</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __max(a, b) ((a) &gt; (b) ? (a) : (b))  </span></div>
<div class="line"><span class="preprocessor">#define __min(a, b) ((a) &lt; (b) ? (a) : (b))  </span></div>
<div class="line"><span class="preprocessor">#define __abs(x)    ((x) &gt;= 0 ? (x) : -(x))  </span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __is_null(ptr)      ((ptr) == NULL)  </span></div>
<div class="line"><span class="preprocessor">#define __is_not_null(ptr)  ((ptr) != NULL)  </span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __mask8(i)   ((uint8_t)(1U &lt;&lt; (i)))     </span></div>
<div class="line"><span class="preprocessor">#define __mask16(i)  ((uint16_t)(1U &lt;&lt; (i)))    </span></div>
<div class="line"><span class="preprocessor">#define __mask32(i)  ((uint32_t)(1UL &lt;&lt; (i)))   </span></div>
<div class="line"><span class="preprocessor">#define __mask64(i)  ((uint64_t)(1ULL &lt;&lt; (i)))  </span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __inv_mask8(i)   ((uint8_t)(~(1U &lt;&lt; (i))))     </span></div>
<div class="line"><span class="preprocessor">#define __inv_mask16(i)  ((uint16_t)(~(1U &lt;&lt; (i))))    </span></div>
<div class="line"><span class="preprocessor">#define __inv_mask32(i)  ((uint32_t)(~(1UL &lt;&lt; (i))))   </span></div>
<div class="line"><span class="preprocessor">#define __inv_mask64(i)  ((uint64_t)(~(1ULL &lt;&lt; (i))))  </span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __is_zero(x)         ((x) == 0)   </span></div>
<div class="line"><span class="preprocessor">#define __is_positive(x)     ((x) &gt; 0)    </span></div>
<div class="line"><span class="preprocessor">#define __is_negative(x)     ((x) &lt; 0)    </span></div>
<div class="line"><span class="preprocessor">#define __isnot_zero(x)      ((x) != 0)   </span></div>
<div class="line"><span class="preprocessor">#define __isnot_positive(x)  ((x) &lt;= 0)   </span></div>
<div class="line"><span class="preprocessor">#define __isnot_negative(x)  ((x) &gt;= 0)   </span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// __HELPER_H__</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
